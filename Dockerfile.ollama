# Dockerfile.ollama
FROM ollama/ollama:latest

# Variable por si quieres cambiar el modelo al hacer build
ARG OLLAMA_MODEL=deepseek-r1:latest

# Descarga los modelos en la imagen (solo una vez al build)
RUN ollama serve & \
    pid=$! && \
    echo "Esperando que el servidor Ollama estÃ© listo..." && \
    for i in $(seq 1 20); do \
      if nc -z 127.0.0.1 11434 >/dev/null 2>&1; then \
        echo "Servidor listo"; break; \
      fi; \
      sleep 2; \
    done && \
    ollama pull "$OLLAMA_MODEL" && \
    ollama pull nomic-embed-text && \
    kill $pid && \
    echo "Modelos descargados correctamente"

# Expone el puerto
EXPOSE 11434

# Ejecuta Ollama normalmente
ENTRYPOINT ["ollama"]
CMD ["serve"]
